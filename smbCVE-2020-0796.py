import subprocess, sys

def SMBGhostScanner(target_ip):
    try:
        # Run the SMBGhost Scanner
        cmd = ["python", "scanner.py", target_ip]
        result = subprocess.run(cmd, capture_output=True, text=True, check=True)
        print(result.stdout)
    except subprocess.CalledProcessError as e:
        print(f"Error executing the scanner: {e.stderr}")
        sys.exit(1)

if __name__ == "__main__":
    
    if len(sys.argv) != 2 and sys.argv[1] != "-f":
        print("Usage: python smb_vulnerability_checker.py <target_ip>")
        print("Usage: python smb_vulnerability_checker.py -f <file_list.txt>")
        sys.exit(1) 
    if(sys.argv[1] == "-f"):
        if(len(sys.argv) !=3):
            print("Usage: python smb_vulnerability_checker.py -f <file_list.txt>")
            sys.exit(1)
        fileName = sys.argv[2]
        targetList = open(fileName,"r")
        for target in targetList:
            print("    [+] Check the SMB Vuln for the target: "+target)
            SMBGhostScanner(target)    
    else:
        if len(sys.argv) != 2:
            print("Usage: python smb_vulnerability_checker.py <target_ip>")
            sys.exit(1)
        target_ip = sys.argv[1]
        print("    [+] Check the SMB Vuln for the target: "+target_ip)
        SMBGhostScanner(target_ip)    
    print("    [!] The SMB Vuln Scanning is Done")
    
    #check_smb_vulnerability(target_ip)